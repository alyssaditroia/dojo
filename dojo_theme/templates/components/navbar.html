{% from "macros/widgets.html" import navitem %}

<nav class="navbar navbar-expand-lg navbar-dark fixed-top main-navbar">
  <div class="container-fluid">
    <a href="{{ url_for('views.static_html', route='/') }}" class="navbar-brand brand-mono-bold">
      {% if Configs.ctf_name == "pwn.college" %}
      <span class="brand-white">pwn</span><span class="brand-dot-white">.</span><span class="brand-white">college</span>
      {% else %}
      <span class="brand-white">{{ Configs.ctf_name }}</span>
      {% endif %}
    </a>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#base-navbars"
            aria-controls="base-navbars" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="base-navbars">
      <ul class="navbar-nav align-items-lg-center">
        {{ navitem("Chat", "https://discord.gg/pwncollege", "fa-comments", new=True) }}
        {{ navitem("Search", "#", "fa-search") }}
      </ul>

      <ul class="navbar-nav mx-lg-auto d-none d-lg-flex align-items-center breadcrumb-nav">
        {{ navitem("Dojos", url_for('pwncollege_dojos.listing'), "fa-torii-gate", shrink=True) }}
        {% if dojo %}
        {{ navitem(dojo.name or dojo.id, url_for('pwncollege_dojo.listing', dojo=dojo.reference_id), "fa-folder", shrink=True) }}
        {% endif %}
        {% if module %}
        {{ navitem(module.name or module.id, url_for('pwncollege_dojo.view_dojo_path', dojo=dojo.reference_id, path=module.id), "fa-book", shrink=True) }}
        {% endif %}
        {% if current_dojo_challenge %}
        <li class="nav-item">
          <span class="nav-link nav-link-static" data-toggle="tooltip" data-placement="bottom" title="{{ current_dojo_challenge.name }}">
            <i class="fas fa-flag pr-1"></i>
            <span>{{ current_dojo_challenge.name }}</span>
          </span>
        </li>
        {% endif %}
      </ul>

      <ul class="navbar-nav ml-lg-auto align-items-lg-center">
        {% if authed() %}
        {% if is_admin() %}
          {{ navitem("Admin Panel", url_for("admin.view"), "fa-wrench", shrink=True) }}
        {% endif %}
        {{ navitem("Profile", url_for("pwncollege_users.view_self"), "fa-user-circle", shrink=True) }}
        {{ navitem("Settings", url_for("views.settings"), "fa-cogs", shrink=True) }}
        {{ navitem("Logout", url_for("auth.logout"), "fa-sign-out-alt", shrink=True) }}
        {% else %}
        {% if registration_visible() %}
        {{ navitem("Register", url_for("auth.register"), "fa-user-plus") }}
        {% endif %}
        {{ navitem("Login", url_for("auth.login", next=request.full_path), "fa-sign-in-alt") }}
        {% endif %}

        <li class="nav-item d-none d-lg-flex">
          <button class="btn btn-link nav-link close-link" type="button">
            <i class="fas fa-caret-up"></i>
          </button>
        </li>
      </ul>

      <div class="d-lg-none w-100 mt-3">
        <button class="btn btn-outline-light btn-block close-link" type="button">
          <i class="fas fa-caret-up mr-2"></i>Hide Navbar
        </button>
      </div>
    </div>
  </div>
</nav>

<div class="navbar-pulldown">
  <i class="fas fa-fw fa-caret-down" title="Show navigation bar"></i>
</div>

<div id="searchModal" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document" style="margin: 8vh auto; max-width: 700px; width: 90%;">
    <div class="modal-content bg-dark text-white" style="border: 1px solid var(--brand-green); border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
      <div class="modal-body p-0">
        <form id="searchForm">
          <div class="input-group input-group-lg" style="border-radius: 12px 12px 0 0; overflow: hidden;">
            <div class="input-group-prepend">
              <span class="input-group-text border-0 text-white" style="background-color: var(--foreground); padding: 1rem;">
                <i class="fas fa-search"></i>
              </span>
            </div>
            <input type="text" id="searchInput" class="form-control text-white border-0" placeholder="Search dojos, modules, or challenges..." autocomplete="off" style="background-color: var(--foreground); font-size: 1.1rem; padding: 1rem;">
            <div class="input-group-append">
              <button type="button" class="btn border-0" data-dismiss="modal" style="background-color: var(--foreground); color: var(--brand-light-gray); padding: 1rem;">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
        </form>
        <div id="searchResults" class="p-4" style="max-height: 60vh; overflow-y: auto;">
          <!-- Results will be inserted here dynamically -->
        </div>
      </div>
    </div>
  </div>
</div>